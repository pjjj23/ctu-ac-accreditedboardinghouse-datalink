{% extends 'SAO-base.html' %}
{% load static %}

{% block content %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approved Students - SAO Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { 
            background-color: #f0f2f5;
        }
        .table-container {
    max-width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin-bottom: 1rem;
    display: block;
}

/* Handle small screens */
@media screen and (max-width: 768px) {
    #disableAccountModal .confirmation-popup-content {
        width: 95%;
        margin: 1rem;
        padding: 1.5rem;
    }
    
    #disableReason {
        font-size: 1rem;
        padding: 0.875rem;
    }
    .confirm-removal-popup .confirmation-popup-content {
        width: 85%;
        padding: 1.5rem;
        margin: 1rem;
    }

    .confirmation-popup-content {
        width: 95% !important;
        margin: 1rem auto !important;
        padding: 1.5rem !important;
    }
    
    #confirmRemovalPopup .confirmation-popup-content {
        margin: 0 1rem !important;
    }
    
    .confirmation-popup button {
        padding: 0.75rem !important;
        font-size: 1rem !important;
    }
    /* Fix for course text overflow */
    td .inline-flex.text-xs {
        white-space: normal !important; /* Allow text to wrap */
        display: inline-block !important;
        width: 100%;
        text-align: left;
        padding: 0.5rem;
        margin-top: 0.5rem;
    }

    /* Make course span wrap properly */
    tr.hover-trigger td:nth-child(3) span {
        white-space: normal;
        display: inline-block;
        width: 100%;
        line-height: 1.4;
        font-size: 0.875rem;
    }

    table {
        display: block;
        width: 100%;
    }

    thead {
        display: none; /* Hide headers on mobile */
    }

    tbody {
        display: block;
        width: 100%;
        background: #f3f4f6; /* Light gray background for tbody */
        padding: 1rem;
    }

    /* Style alternating user sections */
    tr.hover-trigger {
        display: block;
        margin-bottom: 0.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }

    /* Add a colored top border to each user section */
    tr.hover-trigger::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: #4f46e5; /* Indigo color for visual separation */
    }

    tr.hover-trigger:nth-child(4n + 1)::before {
        background: #4f46e5; /* Indigo */
    }

    tr.hover-trigger:nth-child(4n + 2)::before {
        background: #059669; /* Green */
    }

    tr.hover-trigger:nth-child(4n + 3)::before {
        background: #dc2626; /* Red */
    }

    tr.hover-trigger:nth-child(4n + 4)::before {
        background: #f59e0b; /* Yellow */
    }

    tr.hover-trigger td {
        display: block;
        text-align: left;
        padding: 1rem;
        border: none;
        position: relative;
        border-bottom: 1px solid #f3f4f6;
    }

    tr.hover-trigger td:last-child {
        border-bottom: none;
    }

    /* Enhanced headers before content */
    tr.hover-trigger td::before {
        font-weight: 600;
        display: block;
        margin-bottom: 0.75rem;
        color: #4b5563;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
    }

    tr.hover-trigger td:nth-child(1)::before { content: "Student"; }
    tr.hover-trigger td:nth-child(2)::before { content: "Contact"; }
    tr.hover-trigger td:nth-child(3)::before { content: "Course"; }
    tr.hover-trigger td:nth-child(4)::before { content: "Active Status"; }
    tr.hover-trigger td:nth-child(5)::before { content: "Actions"; }

    /* Enhanced button styling for mobile */
    td .flex.space-x-2 {
        display: flex;
        justify-content: space-around;
        padding: 0.5rem 0;
        gap: 1rem;
    }

    td .flex.space-x-2 button {
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #f3f4f6;
        transition: all 0.2s ease;
        width: 3.5rem;
        height: 3.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    td .flex.space-x-2 button i {
        font-size: 1.25rem;
    }

    /* Button specific colors */
    td .flex.space-x-2 button:nth-child(1) { /* Edit button */
        background-color: #e0e7ff;
        color: #4f46e5;
    }

    td .flex.space-x-2 button:nth-child(2) { /* Disable button */
        background-color: #fef3c7;
        color: #d97706;
    }

    td .flex.space-x-2 button:nth-child(3) { /* Delete button */
        background-color: #fee2e2;
        color: #dc2626;
    }

    /* Style the expanded info section */
    tr.hover-target {
        display: block;
        margin-bottom: 1.5rem;
        background: #f8fafc;
        border-radius: 0.75rem;
        padding: 0.5rem;
    }

    tr.hover-target td {
        display: block;
        padding: 1rem;
    }

    /* Adjust the flex layout for student info */
    td .flex.items-center {
        gap: 1rem;
    }

    /* Make profile images larger on mobile */
    td .flex.items-center .h-10.w-10 {
        height: 3rem;
        width: 3rem;
    }

    /* Style status badges */
    td .inline-flex {
        padding: 0.5rem 1rem;
        border-radius: 1rem;
        font-size: 0.875rem;
    }
}

/* Enhanced scrollbar appearance */
.table-container::-webkit-scrollbar {
    height: 6px;
}

.table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.table-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: #555;
}
        .hover-trigger .hover-target {
            display: none;
        }
        .hover-trigger:hover .hover-target {
            display: flex;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { top: -300px; opacity: 0; }
            to { top: 0; opacity: 1; }
        }
        .close-btn {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .edit-modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0, 0, 0, 0.5); /* Black w/ opacity */
}

.edit-modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 90%; /* Could be more or less, depending on screen size */
    max-width: 500px; /* Limit width for larger screens */
    border-radius: 8px; /* Rounded corners */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.edit-close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.edit-close-button:hover,
.edit-close-button:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.edit-modal-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #333;
}

.edit-modal-field {
    margin-bottom: 15px;
}

.edit-modal-field label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #555;
}

.edit-modal-field input,
.edit-modal-field select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
}

.edit-modal-field input:focus,
.edit-modal-field select:focus {
    border-color: #4a90e2; /* Focus color */
    outline: none; /* Remove outline */
}

.edit-save-button {
    background-color: #4a90e2;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

.edit-save-button:hover {
    background-color: #357ABD; /* Darker blue on hover */
}

/* Fix the confirmation popup positioning */
 
.confirmation-popup {
    position: fixed !important;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
}
 
.confirm-removal-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent background */
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.confirm-removal-popup .confirmation-popup-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.75rem;
    width: 90%;
    max-width: 400px; /* Control maximum width on larger screens */
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
}

.confirm-removal-popup h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.confirm-removal-popup p {
    color: #4b5563;
    margin-bottom: 1.5rem;
}

.confirm-removal-popup .confirm-button {
    width: 100%;
    padding: 0.75rem;
    background-color: #ef4444;
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.confirm-removal-popup .confirm-button:hover {
    background-color: #dc2626;
}

.confirm-removal-popup .confirmation-close-button {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    font-size: 1.5rem;
    color: #6b7280;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: 0.25rem;
}

.confirm-removal-popup .confirmation-close-button:hover {
    color: #1f2937;
}


#disableReason {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    background-color: white;  /* Fixed the background color */
    color: #1f2937;
    font-size: 0.875rem;
}

#disableReason:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

/* Enhanced modal styles */
#disableAccountModal.confirm-removal-popup {
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#disableAccountModal .confirmation-popup-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.75rem;
    width: 90%;
    max-width: 400px;
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
}

#disableAccountModal h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

#disableAccountModal .edit-modal-field {
    margin-bottom: 1.5rem;
}

#disableAccountModal .edit-modal-field label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #4b5563;
}

#disableAccountModal .confirm-button {
    width: 100%;
    padding: 0.75rem;
    background-color: #ef4444;
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

#disableAccountModal .confirm-button:hover {
    background-color: #dc2626;
}

#disableAccountModal .confirmation-close-button {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    font-size: 1.5rem;
    color: #6b7280;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: 0.25rem;
}

#disableAccountModal .confirmation-close-button:hover {
    color: #1f2937;
}


.confirmation-popup select,
.confirmation-popup button {
    margin-top: 10px; /* Space above select and button */
    padding: 10px; /* Consistent padding */
    border: 1px solid #ccc; /* Subtle border */
    border-radius: 6px; /* Rounded corners */
    width: 100%; /* Full width */
    font-size: 1rem; /* Consistent font size */
}

.confirmation-popup button {
    background-color: #007bff; /* Bootstrap primary color */
    color: white; /* White text */
    border: none; /* Remove border */
    cursor: pointer; /* Pointer cursor */
    transition: background-color 0.3s; /* Background color transition */
}

.confirmation-popup button:hover {
    background-color: #0056b3; /* Darker shade on hover */
}

/* Optional fade-in animation */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.successAnderrorMessagesPoppedup {
    position: fixed;
    top: 20px;
    right: 20px;
    max-width: 350px;
    padding: 16px 20px;
    border-radius: 12px;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 9999;
    opacity: 0;
    transform: translateX(100px);
    animation: successAnderrorMessagesPoppedup-slideIn 0.3s ease forwards;
}

.successAnderrorMessagesPoppedup.success {
    border-left: 4px solid #10B981;
}

.successAnderrorMessagesPoppedup.error {
    border-left: 4px solid #EF4444;
}

.successAnderrorMessagesPoppedup.slideOut {
    animation: successAnderrorMessagesPoppedup-slideOut 0.3s ease forwards;
}

.successAnderrorMessagesPoppedup-icon {
    font-size: 20px;
    flex-shrink: 0;
}

.success .successAnderrorMessagesPoppedup-icon {
    color: #10B981;
}

.error .successAnderrorMessagesPoppedup-icon {
    color: #EF4444;
}

.successAnderrorMessagesPoppedup-content {
    color: #374151;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.4;
}

@keyframes successAnderrorMessagesPoppedup-slideIn {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes successAnderrorMessagesPoppedup-slideOut {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}



    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-4">
            <a href="{% url 'saohomepage' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
            </a>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Approved Students</h1>
        <div class="mb-4 flex justify-between items-center">
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Search by Student ID..." 
                       class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <div class="messages">
                {% if messages %}
                    {% for message in messages %}
                        <div class="successAnderrorMessagesPoppedup {% if message.tags %}{{ message.tags }}{% endif %}">
                            <div class="successAnderrorMessagesPoppedup-icon">
                                {% if message.tags == 'success' %}
                                    <i class="fas fa-check-circle"></i>
                                {% elif message.tags == 'error' %}
                                    <i class="fas fa-exclamation-circle"></i>
                                {% endif %}
                            </div>
                            <div class="successAnderrorMessagesPoppedup-content">
                                {{ message }}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
            
        </div>
        <div class="table-container bg-white overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="studentTableBody">
                    {% for student in approved_students %}
                    <tr class="hover-trigger" data-id="{{ student.student_id }}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    {% if student.profile_picture %}
                                        <img class="h-10 w-10 rounded-full object-cover" src="{{ student.profile_picture }}" alt="{{ student.username }}">
                                    {% else %}
                                        <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">
                                            <i class="fas fa-user text-gray-500"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">{{ student.username }}</div>
                                    <div class="text-sm text-gray-500">ID: {{ student.student_id }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">{{ student.email }}</div>
                            <div class="text-sm text-gray-500">{{ student.phone }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                {{ student.course }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if student.active_status ==  'online' %} 
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    Online
                                </span>
                            {% else %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    Offline
                                </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button class="text-indigo-600 hover:text-indigo-900" 
                                        onclick="openEditModal('{{ student.username }}', '{{ student.email }}', '{{ student.student_id }}', '{{ student.address }}', '{{ student.gender }}', '{{ student.course }}', '{{ student.birthday }}')">
                                    <i class="fas fa-edit"></i>
                                </button>

                                                                 
                                <button class="text-yellow-600 hover:text-yellow-900" onclick="openConfirmationPopup('{{ student.email }}')">
                                    <i class="fas fa-ban"></i>
                                </button> 

                                <!-- Confirmation Popup --> 
                                <div id="confirmationPopup" class="confirm-removal-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; z-index: 9999;">
                                    <div class="confirmation-popup-content" style="background-color: white; padding: 2rem; border-radius: 0.75rem; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin: auto; transform: translateY(-50%); top: 50%;">
                                        <span class="confirmation-close-button" onclick="closeConfirmationPopup()" style="position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #6b7280; cursor: pointer; border: none; background: transparent; padding: 0.25rem;">&times;</span>
                                        <h2 style="color: #1f2937; font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; text-align: center;">Confirm Disable Account</h2>
                                        <p style="color: #4b5563; margin-bottom: 1.5rem; text-align: center; opacity: 0.7;">Are you sure you want to disable this account?</p>
                                        <p id="displayEmail" style="color: #4b5563; margin-bottom: 1.5rem;">Email: <span style="font-weight: bold;">[email]</span></p><br>
                                        <form id="confirmationForm" method="POST" action="{% url 'view_students' %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="email" id="confirmEmail">
                                            <label for="disableReason" style="display: block; margin-bottom: 0.5rem; color: #4b5563; font-weight: 500;">Reason for Disabling:</label>
                                            <select name="disableReason" id="disableReason" required style="width: 100%; padding: 0.75rem; margin: 0.5rem 0 1rem 0; border: 1px solid #d1d5db; border-radius: 0.5rem; background-color: white; color: #1f2937; font-size: 0.875rem;">
                                                <option value="" selected disabled>Select a reason</option>
                                                <option value="Terms of Service Violation">Terms of Service Violation</option>
                                                <option value="Incomplete Information">Incomplete Information</option>
                                                <option value="Duplicate Account">Duplicate Account</option>
                                                <option value="Account doesn't exist in database">Account doesn't exist in database</option>
                                                <option value="Invalid or False Information">Invalid or False Information</option>
                                                <option value="Failure to Meet Eligibility Criteria">Failure to Meet Eligibility Criteria</option>
                                                <option value="Security Concerns">Security Concerns</option>
                                                <option value="Suspicious or Fraudulent Activity">Suspicious or Fraudulent Activity</option>
                                                <option value="Unverified Email">Unverified Email</option>
                                                <option value="Multiple Attempts with Incorrect Information">Multiple Attempts with Incorrect Information</option>
                                                <option value="Violation of Privacy Policies">Violation of Privacy Policies</option>
                                                <option value="Incomplete Application">Incomplete Application</option>
                                                <option value="Inconsistent Data with Registered Records">Inconsistent Data with Registered Records</option>
                                                <option value="Suspended by Administration">Suspended by Administration</option>
                                                <option value="Inactivity">Inactivity</option>
                                                <option value="Previous Account Ban">Previous Account Ban</option>
                                                <option value="Abuse of Platform Rules">Abuse of Platform Rules</option>
                                            </select>
                                            <br><button type="submit" name="disable_account" class="confirm-button" style="width: 100%; padding: 0.75rem; background-color: #ef4444; color: white; border: none; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s;">Confirm Disable</button>
                                        </form>
                                    </div>
                                </div> 
                                <button class="text-red-600 hover:text-red-900" onclick="confirmRemoval('{{ student.email }}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                                
                        
                            </div>
                        </td>
                    </tr>
                    <tr class="hover-target bg-gray-50">
                        <td colspan="5" class="px-6 py-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-gray-600">
                                        <strong>Last Login:</strong> <span class="formatted-time" data-loggedout="{{ student.timeLoggedOut }}">Calculating...</span>
                                    </p>
                                    <p class="text-sm text-gray-600"><strong>Register Date and Time: </strong>{{ student.signup_time }}</p>
                                </div>
                                <div>
                                    <button onclick="openProfileModal('{{ student.boardinghouseName }}', '{{ student.roomName }}', '{{ student.student_id }}', '{{ student.username }}', '{{ student.phone }}', '{{ student.email }}', '{{ student.address }}', '{{ student.gender }}', '{{ student.course }}', '{{ student.birthday }}', '{{ student.status }}', '{{ student.profile_picture }}', '{{ student.signup_time }}', '{{ student.active_status }}', '{{ student.role }}', '{{ student.accountStatus }}')" 
                                            class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out">
                                        View Full Profile
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No approved students found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="mt-4 flex justify-between items-center">
            <div>
                <p class="text-sm text-gray-700">
                    Showing <span class="font-medium">1</span> to <span class="font-medium">10</span> of <span class="font-medium">97</span> results
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">Previous</span>
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">1</a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">2</a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">3</a>
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">Next</span>
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </nav>
            </div>
        </div>
    </div>
     <!-- Modal for Full Profile -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeProfileModal()">&times;</span>
            <h2 class="text-2xl font-semibold mb-4">Student Full Profile</h2>
            <div class="flex items-center mb-4">
                <img id="modalProfilePicture" class="h-16 w-16 rounded-full object-cover mr-4" src="#" alt="Profile Picture">
                <div>
                    <h3 id="modalName" class="text-xl font-bold"></h3>
                    <p><strong>Student ID:</strong> <span id="modalStudentID"></span></p>
                    <p id="modalEmail" class="text-gray-600"></p>
                    <p id="modalPhone" class="text-gray-600"></p>
                </div>
            </div>
            <div class="mb-4">
                <p><strong>STAYING IN:</strong> <span id="boardinghouseName" style="font-weight: 900; color:#374151; text-align: center;"></span></p>
                <p><strong>ROOM NAME:</strong> <span id="roomName" style="font-weight: 900; color:#374151; text-align: center;"></span></p>
                <p><strong>Address:</strong> <span id="modalAddress"></span></p> 
                <p><strong>Gender:</strong> <span id="modalGender"></span></p>
                <p><strong>Course:</strong> <span id="modalCourse"></span></p>
                <p><strong>Birthday:</strong> <span id="modalBirthday"></span></p>
                <p><strong>Status:</strong> <span id="modalStatus"></span></p> 
                <p><strong>Signup Date:</strong> <span id="modalSignupTime"></span></p>
                <p><strong>Active Status:</strong> <span id="modalActiveStatus"></span></p>
                <p><strong>Role:</strong> <span id="modalRole"></span></p>
                <p><strong>Account Status:</strong> <span id="modalAccountStatus"></span></p>
            </div>
            <button class="bg-red-500 hover:bg-red-600 text-white text-sm font-semibold py-2 px-4 rounded-lg" onclick="closeProfileModal()">
                Close
            </button>
        </div>
    </div>

    <!-- Edit Profile Modal -->
<div id="editProfileModal" class="edit-modal">
    <div class="edit-modal-content">
        <span class="edit-close-button" onclick="closeEditModal()">&times;</span>
        <h2 class="edit-modal-title">Edit Profile</h2>
        
        <form id="editProfileForm" method="POST" action="{% url 'view_students' %}"> <!-- Replace 'your_edit_view' with your actual view name -->
            {% csrf_token %}
            <div class="edit-modal-field">
                <label for="editEmail">Email</label>
                <input type="email" style="opacity: 0.5;" id="editEmail" name="email" placeholder="Enter your email" required readonly>
            </div>                        
            <div class="edit-modal-field">
                <label for="editUsername">Username</label>
                <input type="text" id="editUsername" name="username" placeholder="Enter your username" required>
            </div>
            
            <div class="edit-modal-field">
                <label for="editStudentID">Student ID</label>
                <input type="text" id="editStudentID" name="student_id" placeholder="Enter your student ID" required>
            </div>
            
            <div class="edit-modal-field">
                <label for="editAddress">Address</label>
                <input type="text" id="editAddress" name="address" placeholder="Enter your address" required>
            </div>
            
            <div class="edit-modal-field">
                <label for="editGender">Gender</label>
                <select id="editGender" name="gender" required>
                    <option value="" disabled selected>Select Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                </select>
            </div>
            
            <div class="edit-modal-field">
                <label for="editBirthday">Birthday</label>
                <input type="date" id="editBirthday" name="birthday" required>
            </div>
            
            <div class="edit-modal-field">
                <label for="editCourse">Course</label>
                <select id="editCourse" name="course" required>
                    <option value="" disabled selected>-- Select your Course --</option>
                    <option value="BACHELOR OF INDUSTRIAL TECHNOLOGY">BACHELOR OF INDUSTRIAL TECHNOLOGY</option>
                    <option value="HOSPITALITY MANAGEMENT">HOSPITALITY MANAGEMENT</option>
                    <option value="BACHELOR OF SCIENCE IN TOURISM MANAGEMENT">BACHELOR OF SCIENCE IN TOURISM MANAGEMENT</option>
                    <option value="BACHELOR OF SCIENCE IN INFORMATION TECHNOLOGY">BACHELOR OF SCIENCE IN INFORMATION TECHNOLOGY</option>
                    <option value="BACHELOR OF SCIENCE IN INDUSTRIAL ENGINEERING">BACHELOR OF SCIENCE IN INDUSTRIAL ENGINEERING</option>
                    <option value="BACHELOR OF SCIENCE IN AGRICULTURE">BACHELOR OF SCIENCE IN AGRICULTURE</option>
                    <option value="BACHELOR OF SCIENCE IN FORESTRY">BACHELOR OF SCIENCE IN FORESTRY</option>
                    <option value="BACHELOR OF SCIENCE IN ENVIRONMENTAL SCIENCE">BACHELOR OF SCIENCE IN ENVIRONMENTAL SCIENCE</option>
                    <option value="BACHELOR OF ARTS IN ENGLISH LANGUAGE">BACHELOR OF ARTS IN LANGUAGE</option>
                    <option value="BACHELOR OF ARTS IN LITERATURE">BACHELOR OF ARTS IN LITERATURE</option>
                    <option value="BACHELOR OF SCIENCE IN PSYCHOLOGY">BACHELOR OF SCIENCE IN PSYCHOLOGY</option>
                    <option value="BACHELOR IN TECHNOLOGY AND LIVELIHOOD EDUCATION">BACHELOR IN TECHNOLOGY AND LIVELIHOOD EDUCATION</option>
                    <option value="BACHELOR OF SECONDARY EDUCATION MAJOR IN MATHEMATICS">BACHELOR OF SECONDARY EDUCATION MAJOR IN MATHEMATICS</option>
                    <option value="BACHELOR OF ELEMENTARY EDUCATION">BACHELOR OF ELEMENTARY EDUCATION</option>
                </select>
            </div> 
            <button type="submit" class="edit-save-button">Save Changes</button>
        </form>
    </div>
</div>

<div class="confirm-removal-popup" id="confirmRemovalPopup" style="display: none;">
    <div class="confirmation-popup-content">
        <button class="confirmation-close-button" onclick="closeconfirmRemovalPopup()">&times;</button>
        <h2>Confirm Account Removal</h2>
        <p id="displayEmailRemoval" style="color: #4b5563; margin-bottom: 1.5rem;">Email: <span style="font-weight: bold;">[email]</span></p><br>
        <p>Are you sure you want to remove this account?</p>
        <form id="confirmationForm" method="POST" action="{% url 'view_students' %}">
            {% csrf_token %}
            <input type="hidden" id="confirmEmail2" name="email" value=""> 
            <button type="submit" name="delete_account" class="confirm-button">Confirm Removal</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
         // Function to format time logged out
    function formatTimeLoggedOut(seconds) {
        if (seconds >= 86400) {
            const days = Math.floor(seconds / 86400);
            return days === 1 ? "1 day" : `${days} days`;
        } else if (seconds >= 3600) {
            const hours = Math.floor(seconds / 3600);
            const remainingMinutes = Math.floor((seconds % 3600) / 60);
            return hours === 1 
                ? `1 hour${remainingMinutes ? `, ${remainingMinutes} minutes` : ''}`
                : `${hours} hours${remainingMinutes ? `, ${remainingMinutes} minutes` : ''}`;
        } else if (seconds >= 60) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return minutes === 1 
                ? `1 minute${remainingSeconds ? `, ${remainingSeconds} seconds` : ''}`
                : `${minutes} minutes${remainingSeconds ? `, ${remainingSeconds} seconds` : ''}`;
        } else {
            return `${seconds} second${seconds === 1 ? '' : 's'}`;
        }
    }

    // Calculate and display formatted time for each student
    document.querySelectorAll('.formatted-time').forEach(function(element) {
        const seconds = parseInt(element.getAttribute('data-loggedout'));
        element.textContent = formatTimeLoggedOut(seconds);
    });
        

        const messageList = document.querySelector('.message-list');

                
            if (messageList) {
                setTimeout(() => {
                    messageList.style.transition = "opacity 0.5s ease"; // Transition effect
                    messageList.style.opacity = 0; // Fade out effect
                    setTimeout(() => {
                        messageList.remove(); // Remove from DOM after fading out
                    }, 500); // Match this duration with the transition time
                }, 2000); // 2 seconds before starting to fade out
            }

        
            function openProfileModal(boardinghouseName, roomName, student_id, username, phone, email, address, gender, course, birthday, status, profile_picture, signup_time, active_status, role, accountStatus) {
                const modal = document.getElementById("profileModal");

                // Check if modal exists
                if (!modal) {
                    console.error("Modal not found!");
                    return;
                }

                // Populate modal with individual student data
                modal.querySelector("#boardinghouseName").innerText = boardinghouseName;
                modal.querySelector("#roomName").innerText = roomName;
                modal.querySelector("#modalStudentID").innerText = student_id;
                modal.querySelector("#modalName").innerText = username;
                modal.querySelector("#modalPhone").innerText = phone;
                modal.querySelector("#modalEmail").innerText = email;
                modal.querySelector("#modalAddress").innerText = address;
                modal.querySelector("#modalGender").innerText = gender;
                modal.querySelector("#modalCourse").innerText = course;
                modal.querySelector("#modalBirthday").innerText = birthday;
                modal.querySelector("#modalStatus").innerText = status;
                modal.querySelector("#modalProfilePicture").src = profile_picture || "{% static 'default_profile.png' %}";
                modal.querySelector("#modalSignupTime").innerText = signup_time;
                modal.querySelector("#modalActiveStatus").innerText = active_status;
                modal.querySelector("#modalRole").innerText = role;
                modal.querySelector("#modalAccountStatus").innerText = accountStatus;

                // Display the modal
                modal.style.display = "block";
            }

    
        // Function to close the modal
        function closeProfileModal() {
            document.getElementById("profileModal").style.display = "none";
        }
    
        function openEditModal(username, email, student_id, address, gender, course, birthday) {
    console.log("Student Data:", { username, email, student_id, address, gender, course, birthday }); // Log the student data
    
    const modal = document.getElementById("editProfileModal");

    // Check if the modal is null
    if (!modal) {
        console.error("Modal not found!");
        return;
    }

    // Populate the fields with the passed student data
    document.getElementById("editUsername").value = username;
    document.getElementById("editStudentID").value = student_id;
    document.getElementById("editAddress").value = address;

    // Set the gender dropdown value
    const genderDropdown = document.getElementById("editGender");
    genderDropdown.value = gender; // Set the selected option

    document.getElementById("editBirthday").value = birthday;
    document.getElementById("editEmail").value = email;

    // Set the course dropdown value
    const courseDropdown = document.getElementById("editCourse");
    courseDropdown.value = course; // Set the selected option

    // Show the modal
    modal.style.display = "block";
}

    
        // Function to close the edit modal
        function closeEditModal() {
            const modal = document.getElementById("editProfileModal");
            if (modal) {
                modal.style.display = "none";
            }
        }
    
        // Move confirmation popup functions outside of openEditModal
        function openConfirmationPopup(email) {
            console.log("Opening confirmation popup for:", email);
            document.getElementById("confirmEmail").value = email;
            document.getElementById("displayEmail").innerHTML = `Email: <span style="font-weight: bold;">${email}</span>`;
    
            document.getElementById("confirmationPopup").style.display = "block";
        }
    
        function closeConfirmationPopup() {
            document.getElementById("confirmationPopup").style.display = "none";
        }

        function closeconfirmRemovalPopup() {
            document.getElementById("confirmRemovalPopup").style.display = "none";
        }
    
        // Make functions globally accessible
        window.openProfileModal = openProfileModal;
        window.closeProfileModal = closeProfileModal;
        window.openEditModal = openEditModal;
        window.closeEditModal = closeEditModal;
        window.openConfirmationPopup = openConfirmationPopup;
        window.closeConfirmationPopup = closeConfirmationPopup;
        window.closeconfirmRemovalPopup = closeconfirmRemovalPopup;
         
    });

    function confirmRemoval(email) {
    console.log('Email for removal:', email); // Debugging

    // Set the value of the hidden input
    document.getElementById('confirmEmail2').value = email;

    // Update the content of the <p> element with the email
    document.getElementById('displayEmailRemoval').innerHTML = `Email: <span style="font-weight: bold;">${email}</span>`;

    // Display the popup
    document.getElementById('confirmRemovalPopup').style.display = 'flex';
}

const messages = document.querySelectorAll('.successAnderrorMessagesPoppedup');
    
    messages.forEach(message => {
        // Set timeout to remove message after 3 seconds
        setTimeout(() => {
            message.classList.add('slideOut');
            
            // Remove element after animation completes
            message.addEventListener('animationend', function(e) {
                if (e.animationName === 'successAnderrorMessagesPoppedup-slideOut') {
                    message.remove();
                }
            });
        }, 3000);
    });


// JavaScript to handle the search functionality
document.getElementById('searchInput').addEventListener('input', function (e) {
    const query = e.target.value.toLowerCase().trim(); // Get search input, convert to lowercase, and trim whitespace
    const rows = document.querySelectorAll('#studentTableBody tr.hover-trigger'); // Select rows with `hover-trigger` class

    rows.forEach(row => {
        const studentID = row.getAttribute('data-id').toLowerCase(); // Get the student_id from the `data-id` attribute

        // Display row if it matches the query; otherwise, hide it
        if (studentID.includes(query)) {
            row.style.display = '';
            row.nextElementSibling.style.display = ''; // Ensure associated hover-target row is also displayed
        } else {
            row.style.display = 'none';
            row.nextElementSibling.style.display = 'none'; // Hide associated hover-target row
        }
    });
});




    </script>
</body>
{% endblock %}
