{% extends 'SAO-base.html' %}
{% load static %}

{% block content %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Approved Students - SAO Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { 
            background-color: #f0f2f5;
        }
        .table-container {
    max-width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    margin-bottom: 1rem;
    display: block;
}
.address-container {
        line-height: 1.5;
    }
/* Handle small screens */
@media screen and (max-width: 768px) {
    .address-container {
            word-break: break-word;
            overflow-wrap: break-word;
            margin: 0.5rem;
        }
    #disableAccountModal .confirmation-popup-content {
        width: 95%;
        margin: 1rem;
        padding: 1.5rem;
    }
    
    #disableReason {
        font-size: 1rem;
        padding: 0.875rem;
    }
    .confirm-removal-popup .confirmation-popup-content {
        width: 85%;
        padding: 1.5rem;
        margin: 1rem;
    }

    .confirmation-popup-content {
        width: 95% !important;
        margin: 1rem auto !important;
        padding: 1.5rem !important;
    }
    
    #confirmRemovalPopup .confirmation-popup-content {
        margin: 0 1rem !important;
    }
    
    .confirmation-popup button {
        padding: 0.75rem !important;
        font-size: 1rem !important;
    }
    /* Fix for course text overflow */
    td .inline-flex.text-xs {
        white-space: normal !important; /* Allow text to wrap */
        display: inline-block !important;
        width: 100%;
        text-align: left;
        padding: 0.5rem;
        margin-top: 0.5rem;
    }

    /* Make course span wrap properly */
    tr.hover-trigger td:nth-child(3) span {
        white-space: normal;
        display: inline-block;
        width: 100%;
        line-height: 1.4;
        font-size: 0.875rem;
    }

    table {
        display: block;
        width: 100%;
    }

    thead {
        display: none; /* Hide headers on mobile */
    }

    tbody {
        display: block;
        width: 100%;
        background: #f3f4f6; /* Light gray background for tbody */
        padding: 1rem;
    }

    /* Style alternating user sections */
    tr.hover-trigger {
        display: block;
        margin-bottom: 0.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.75rem;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }

    /* Add a colored top border to each user section */
    tr.hover-trigger::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: #4f46e5; /* Indigo color for visual separation */
    }

    tr.hover-trigger:nth-child(4n + 1)::before {
        background: #4f46e5; /* Indigo */
    }

    tr.hover-trigger:nth-child(4n + 2)::before {
        background: #059669; /* Green */
    }

    tr.hover-trigger:nth-child(4n + 3)::before {
        background: #dc2626; /* Red */
    }

    tr.hover-trigger:nth-child(4n + 4)::before {
        background: #f59e0b; /* Yellow */
    }

    tr.hover-trigger td {
        display: block;
        text-align: left;
        padding: 1rem;
        border: none;
        position: relative;
        border-bottom: 1px solid #f3f4f6;
    }

    tr.hover-trigger td:last-child {
        border-bottom: none;
    }

    /* Enhanced headers before content */
    tr.hover-trigger td::before {
        font-weight: 600;
        display: block;
        margin-bottom: 0.75rem;
        color: #4b5563;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
    }

    tr.hover-trigger td:nth-child(1)::before { content: "Owners"; }
    tr.hover-trigger td:nth-child(2)::before { content: "Contact"; }
    tr.hover-trigger td:nth-child(3)::before { content: "Course"; }
    tr.hover-trigger td:nth-child(4)::before { content: "Active Status"; }
    tr.hover-trigger td:nth-child(5)::before { content: "Actions"; }

    /* Enhanced button styling for mobile */
    td .flex.space-x-2 {
        display: flex;
        justify-content: space-around;
        padding: 0.5rem 0;
        gap: 1rem;
    }

    td .flex.space-x-2 button {
        padding: 1rem;
        border-radius: 0.5rem;
        background-color: #f3f4f6;
        transition: all 0.2s ease;
        width: 3.5rem;
        height: 3.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    td .flex.space-x-2 button i {
        font-size: 1.25rem;
    }

    /* Button specific colors */
    td .flex.space-x-2 button:nth-child(1) { /* Edit button */
        background-color: #e0e7ff;
        color: #4f46e5;
    }

    td .flex.space-x-2 button:nth-child(2) { /* Disable button */
        background-color: #fef3c7;
        color: #d97706;
    }

    td .flex.space-x-2 button:nth-child(3) { /* Delete button */
        background-color: #fee2e2;
        color: #dc2626;
    }

    /* Style the expanded info section */
    tr.hover-target {
        display: block;
        margin-bottom: 1.5rem;
        background: #f8fafc;
        border-radius: 0.75rem;
        padding: 0.5rem;
    }

    tr.hover-target td {
        display: block;
        padding: 1rem;
    }

    /* Adjust the flex layout for student info */
    td .flex.items-center {
        gap: 1rem;
    }

    /* Make profile images larger on mobile */
    td .flex.items-center .h-10.w-10 {
        height: 3rem;
        width: 3rem;
    }

    /* Style status badges */
    td .inline-flex {
        padding: 0.5rem 1rem;
        border-radius: 1rem;
        font-size: 0.875rem;
    }
}

/* Enhanced scrollbar appearance */
.table-container::-webkit-scrollbar {
    height: 6px;
}

.table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.table-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: #555;
}
        .hover-trigger .hover-target {
            display: none;
        }
        .hover-trigger:hover .hover-target {
            display: flex;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 8px;
            width: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { top: -300px; opacity: 0; }
            to { top: 0; opacity: 1; }
        }
        .close-btn {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .edit-modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1000; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0, 0, 0, 0.5); /* Black w/ opacity */
}

.edit-modal-content {
    background-color: #fefefe;
    margin: 15% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 90%; /* Could be more or less, depending on screen size */
    max-width: 500px; /* Limit width for larger screens */
    border-radius: 8px; /* Rounded corners */
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
}

.edit-close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}

.edit-close-button:hover,
.edit-close-button:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}

.edit-modal-title {
    font-size: 24px;
    margin-bottom: 20px;
    color: #333;
}

.edit-modal-field {
    margin-bottom: 15px;
}

.edit-modal-field label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #555;
}

.edit-modal-field input,
.edit-modal-field select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
}

.edit-modal-field input:focus,
.edit-modal-field select:focus {
    border-color: #4a90e2; /* Focus color */
    outline: none; /* Remove outline */
}

.edit-save-button {
    background-color: #4a90e2;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

.edit-save-button:hover {
    background-color: #357ABD; /* Darker blue on hover */
}

/* Fix the confirmation popup positioning */
 
.confirmation-popup {
    position: fixed !important;
    display: flex;
    justify-content: center;
    align-items: center;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
}
 
.confirm-removal-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7); /* Dark semi-transparent background */
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.confirm-removal-popup .confirmation-popup-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.75rem;
    width: 90%;
    max-width: 400px; /* Control maximum width on larger screens */
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
}

.confirm-removal-popup h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.confirm-removal-popup p {
    color: #4b5563;
    margin-bottom: 1.5rem;
}

.confirm-removal-popup .confirm-button {
    width: 100%;
    padding: 0.75rem;
    background-color: #ef4444;
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

.confirm-removal-popup .confirm-button:hover {
    background-color: #dc2626;
}

.confirm-removal-popup .confirmation-close-button {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    font-size: 1.5rem;
    color: #6b7280;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: 0.25rem;
}

.confirm-removal-popup .confirmation-close-button:hover {
    color: #1f2937;
}


#disableReason {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    background-color: white;  /* Fixed the background color */
    color: #1f2937;
    font-size: 0.875rem;
}

#disableReason:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
}

/* Enhanced modal styles */
#disableAccountModal.confirm-removal-popup {
    background-color: rgba(0, 0, 0, 0.7);
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#disableAccountModal .confirmation-popup-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.75rem;
    width: 90%;
    max-width: 400px;
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
}

#disableAccountModal h2 {
    color: #1f2937;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

#disableAccountModal .edit-modal-field {
    margin-bottom: 1.5rem;
}

#disableAccountModal .edit-modal-field label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #4b5563;
}

#disableAccountModal .confirm-button {
    width: 100%;
    padding: 0.75rem;
    background-color: #ef4444;
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
}

#disableAccountModal .confirm-button:hover {
    background-color: #dc2626;
}

#disableAccountModal .confirmation-close-button {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    font-size: 1.5rem;
    color: #6b7280;
    cursor: pointer;
    border: none;
    background: transparent;
    padding: 0.25rem;
}

#disableAccountModal .confirmation-close-button:hover {
    color: #1f2937;
}


.confirmation-popup select,
.confirmation-popup button {
    margin-top: 10px; /* Space above select and button */
    padding: 10px; /* Consistent padding */
    border: 1px solid #ccc; /* Subtle border */
    border-radius: 6px; /* Rounded corners */
    width: 100%; /* Full width */
    font-size: 1rem; /* Consistent font size */
}

.confirmation-popup button {
    background-color: #007bff; /* Bootstrap primary color */
    color: white; /* White text */
    border: none; /* Remove border */
    cursor: pointer; /* Pointer cursor */
    transition: background-color 0.3s; /* Background color transition */
}

.confirmation-popup button:hover {
    background-color: #0056b3; /* Darker shade on hover */
}

/* Optional fade-in animation */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

.successAnderrorMessagesPoppedup {
    position: fixed;
    top: 20px;
    right: 20px;
    max-width: 350px;
    padding: 16px 20px;
    border-radius: 12px;
    background: white;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 9999;
    opacity: 0;
    transform: translateX(100px);
    animation: successAnderrorMessagesPoppedup-slideIn 0.3s ease forwards;
}

.successAnderrorMessagesPoppedup.success {
    border-left: 4px solid #10B981;
}

.successAnderrorMessagesPoppedup.error {
    border-left: 4px solid #EF4444;
}

.successAnderrorMessagesPoppedup.slideOut {
    animation: successAnderrorMessagesPoppedup-slideOut 0.3s ease forwards;
}

.successAnderrorMessagesPoppedup-icon {
    font-size: 20px;
    flex-shrink: 0;
}

.success .successAnderrorMessagesPoppedup-icon {
    color: #10B981;
}

.error .successAnderrorMessagesPoppedup-icon {
    color: #EF4444;
}

.successAnderrorMessagesPoppedup-content {
    color: #374151;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.4;
}

@keyframes successAnderrorMessagesPoppedup-slideIn {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes successAnderrorMessagesPoppedup-slideOut {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}

.view-profile-button, .view-students-button {
        font-size: 0.875rem;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        transition: background-color 0.3s ease-in-out;
    }
    .view-profile-button {
        background-color: #3b82f6;
        color: white;
    }
    .view-profile-button:hover {
        background-color: #2563eb;
    }
    .view-students-button {
        background-color: #10b981;
        color: white;
    }
    .view-students-button:hover {
        background-color: #059669;
    }

    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-4">
            <a href="{% url 'saohomepage' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
            </a>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Approved Owners</h1>
        <div class="mb-4 flex justify-between items-center">
            <div class="relative">
                <input 
                    type="text" 
                    placeholder="Search owners..." 
                    class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            
            <div class="messages">
                {% if messages %}
                    {% for message in messages %}
                        <div class="successAnderrorMessagesPoppedup {% if message.tags %}{{ message.tags }}{% endif %}">
                            <div class="successAnderrorMessagesPoppedup-icon">
                                {% if message.tags == 'success' %}
                                    <i class="fas fa-check-circle"></i>
                                {% elif message.tags == 'error' %}
                                    <i class="fas fa-exclamation-circle"></i>
                                {% endif %}
                            </div>
                            <div class="successAnderrorMessagesPoppedup-content">
                                {{ message }}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
            
        </div>
        <div class="table-container bg-white overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Owners</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Boarding House Name/Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Active Status</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr> 
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="ownerTableBody">
                    {% for owner in owners %}
                    <tr class="hover-trigger" data-firstname="{{ owner.firstname }}" data-lastname="{{ owner.lastname }}" data-boardinghouse-name="{{ owner.boardinghouseName }}">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-10 w-10">
                                    {% if owner.profile_picture %}
                                        <img class="h-10 w-10 rounded-full object-cover" src="{{ owner.profile_picture }}" alt="{{ owner.firstname }} {{ owner.lastname }}">
                                    {% else %}
                                        <div class="h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center">
                                            <i class="fas fa-user text-gray-500"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">{{ owner.firstname }} {{ owner.lastname }}</div>
                                    <div class="address-container text-sm text-gray-500">
                                        Address: {{ owner.address }}
                                    </div>

                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">{{ owner.email }}</div>
                            <div class="text-sm text-gray-500">{{ owner.phone_number }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-bold text-gray-900">{{ owner.boardinghouseName }}</div>
                            <div class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-50 text-green-400">{{ owner.boardinghouseStatus }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if owner.active_status == 'online' %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    Online
                                </span>
                            {% else %}
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                    Offline
                                </span>
                            {% endif %}
                        </td> 
                
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button class="text-indigo-600 hover:text-indigo-900" 
                                        onclick="openEditModal(
                                            '{{ owner.firstname }}',
                                            '{{ owner.middlename }}',
                                            '{{ owner.lastname }}',
                                            '{{ owner.phone_number }}',
                                            '{{ owner.address }}',
                                            '{{ owner.gender }}',
                                            '{{ owner.birthday }}',
                                            '{{ owner.email }}'
                                        )">
                                    <i class="fas fa-edit"></i>
                                </button>

                                                                 
                                <button class="text-yellow-600 hover:text-yellow-900" onclick="openConfirmationPopup('{{ owner.email }}')">
                                    <i class="fas fa-ban"></i>
                                </button>

                                <!-- Confirmation Popup --> 
                                <div id="confirmationPopup" class="confirmation-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; z-index: 9999;">
                                    <div class="confirmation-popup-content" style="background-color: white; padding: 2rem; border-radius: 0.75rem; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); margin: auto; transform: translateY(-50%); top: 50%;">
                                        <span class="confirmation-close-button" onclick="closeConfirmationPopup()" style="position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #6b7280; cursor: pointer; border: none; background: transparent; padding: 0.25rem;">&times;</span>
                                        <h2 style="color: #1f2937; font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem; text-align: center;">Confirm Disable Account</h2>
                                        <p style="color: #4b5563; margin-bottom: 1.5rem; text-align: center;">Are you sure you want to disable this account?</p>
                                        <p id="displayEmail" style="color: #4b5563; margin-bottom: 1.5rem;">Email: <span style="font-weight: bold;">[email]</span></p><br>
                                        <form id="confirmationForm" method="POST" action="{% url 'view_owners' %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="email" id="confirmEmail">
                                            <label for="disableReason" style="display: block; margin-bottom: 0.5rem; color: #4b5563; font-weight: 500;">Reason for Disabling:</label>
                                            <select name="disableReason" id="disableReason" required style="width: 100%; padding: 0.75rem; margin: 0.5rem 0 1rem 0; border: 1px solid #d1d5db; border-radius: 0.5rem; background-color: white; color: #1f2937; font-size: 0.875rem;">
                                                <option value="" selected disabled>Select a reason</option>
                                                <option value="Terms of Service Violation">Terms of Service Violation</option>
                                                <option value="Incomplete Information">Incomplete Information</option>
                                                <option value="Duplicate Account">Duplicate Account</option>
                                                <option value="Account doesn't exist in database">Account doesn't exist in database</option>
                                                <option value="Invalid or False Information">Invalid or False Information</option>
                                                <option value="Failure to Meet Eligibility Criteria">Failure to Meet Eligibility Criteria</option>
                                                <option value="Security Concerns">Security Concerns</option>
                                                <option value="Suspicious or Fraudulent Activity">Suspicious or Fraudulent Activity</option>
                                                <option value="Unverified Email">Unverified Email</option>
                                                <option value="Multiple Attempts with Incorrect Information">Multiple Attempts with Incorrect Information</option>
                                                <option value="Violation of Privacy Policies">Violation of Privacy Policies</option>
                                                <option value="Incomplete Application">Incomplete Application</option>
                                                <option value="Inconsistent Data with Registered Records">Inconsistent Data with Registered Records</option>
                                                <option value="Suspended by Administration">Suspended by Administration</option>
                                                <option value="Inactivity">Inactivity</option>
                                                <option value="Previous Account Ban">Previous Account Ban</option>
                                                <option value="Abuse of Platform Rules">Abuse of Platform Rules</option>
                                            </select> 
                                            <br><button type="submit" name="disable_account" class="confirm-button" style="width: 100%; padding: 0.75rem; background-color: #ef4444; color: white; border: none; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s;">Confirm Disable</button>
                                        </form>
                                    </div>
                                </div>  
                                <button class="text-red-600 hover:text-red-900" onclick="confirmRemoval('{{ owner.email }}')">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                                
                        
                            </div>
                        </td>
                    </tr>
                    <tr class="hover-target bg-gray-50">
                        <td colspan="5" class="px-6 py-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-sm text-gray-600">
                                        <strong>Last Login:</strong> <span class="formatted-time" data-loggedout="{{ owner.timeLoggedOut }}">Calculating...</span>
                                    </p>
                                    <p class="text-sm text-gray-600"><strong>Register Date and Time: </strong>{{ owner.signup_time }}</p>
                                </div>
                                <div>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;"> 
                                        <button onclick="openProfileModal({{ owner }})" class="view-profile-button">
                                            View Full Profile
                                        </button>
                                        <button 
                                            onclick="filterStudentsByOwner('{{ owner.boardinghouseName }}')" 
                                            class="view-students-button">
                                            View Students Applied Here
                                        </button>
                                    </div>

                                    <div 
    id="studentsBoardingApplied" 
    style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(31, 41, 55, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; display: none;"
>
    <div 
        class="modal-container" 
        style="background-color: white; border-radius: 0.5rem; width: 66.6667%; max-width: 700px; padding: 2rem; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); position: relative; overflow-y: auto; max-height: 80vh;"
    >
        <button 
            style="position: absolute; top: 1rem; right: 1rem; color: #6b7280; background: none; border: none; font-size: 1.5rem; cursor: pointer;"
            onclick="closeStudentsBoardingAppliedModal()"
        >
            <i class="fas fa-times"></i>
        </button>
        
        <h2 
            id="modalTitle" 
            style="text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;"
        >
            Students Applied in
        </h2>

        <div 
            id="modalContent" 
            style="overflow-y: auto; max-height: 60vh; margin-bottom: 1rem;"
        >
            <!-- Dynamic content -->
        </div>
        
        <div 
            style="margin-top: 1rem; text-align: right;"
        >
            <button 
                style="background-color: #ef4444; color: white; font-size: 0.875rem; font-weight: 500; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s;"
                onmouseover="this.style.backgroundColor='#dc2626';"
                onmouseout="this.style.backgroundColor='#ef4444';"
                onclick="closeStudentsBoardingAppliedModal()"
            >
                Close
            </button>
        </div>
    </div>
</div>
                                    

                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No approved owners found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="mt-4 flex justify-between items-center">
            <div>
                <p class="text-sm text-gray-700">
                    Showing <span class="font-medium">1</span> to <span class="font-medium">10</span> of <span class="font-medium">97</span> results
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">Previous</span>
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">1</a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">2</a>
                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">3</a>
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">Next</span>
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </nav>
            </div>
        </div>
    </div>
     <!-- Modal to display owner profile -->
     <div 
     id="profileModal" 
     style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(31, 41, 55, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000; display: none;"
 >
     <div 
         class="modal-content" 
         style="background-color: white; border-radius: 0.5rem; width: 70%; max-width: 800px; padding: 2rem; box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); position: relative; overflow-y: auto; max-height: 85vh;"
     >
         <button 
             style="position: absolute; top: 1rem; right: 1rem; color: #6b7280; background: none; border: none; font-size: 1.5rem; cursor: pointer;"
             onclick="closeProfileModal()"
         >
             &times;
         </button>
 
         <h2 
             style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem; text-align: center;"
         >
             Owner Full Profile
         </h2>
 
         <div 
             style="display: flex; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; text-align: center;"
         >
             <img 
                 id="modalProfilePicture" 
                 style="height: 4rem; width: 4rem; border-radius: 50%; object-fit: cover; margin-right: 1rem;"
                 src="#" 
                 alt="Profile Picture"
             >
             <div>
                 <h3 
                     id="modalName" 
                     style="font-size: 1.25rem; font-weight: 700;"
                 ></h3>
                 <p><strong>Email:</strong> <span id="modalEmail"></span></p>
                 <p><strong>Boarding House:</strong> <span id="modalBoardingHouse"></span></p>
             </div>
         </div>
 
         <div 
             style="margin-bottom: 1rem;"
         >
             <p><strong>Address:</strong> <span id="modalAddress"></span></p>
             <p><strong>Gender:</strong> <span id="modalGender"></span></p>
             <p><strong>Phone number:</strong> <span id="modalPhone"></span></p>
             <p><strong>Boarding House Status:</strong> <span id="modalBoardingHouseStatus"></span></p>
             <p><strong>Account Status:</strong> <span id="modalAccountStatus"></span></p>
             <p><strong>Active Status:</strong> <span id="modalActiveStatus"></span></p>
             <p><strong>Signup Date:</strong> <span id="modalSignupTime"></span></p>
         </div>
 
         <form 
             action="{% url 'view_owners_boarding_house' %}" 
             method="post" 
             style="display: flex; justify-content: space-between; flex-wrap: wrap;"
         >
             <a 
                 style="background-color: #ef4444; color: white; font-size: 0.875rem; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; text-align: center; flex: 1; margin-right: 10px; text-decoration: none;"
                 onmouseover="this.style.backgroundColor='#dc2626';"
                 onmouseout="this.style.backgroundColor='#ef4444';"
                 onclick="closeProfileModal()"
             >
                 Close
             </a>
             {% csrf_token %}
             <input type="hidden" name="owner_email" value="{{ owner.email }}">
             <button 
                 type="submit" 
                 style="background-color: #3b82f6; color: white; font-size: 0.875rem; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; text-align: center; flex: 1;"
                 onmouseover="this.style.backgroundColor='#2563eb';"
                 onmouseout="this.style.backgroundColor='#3b82f6';"
             >
                 View Boarding House
             </button>
         </form>    
     </div>
 </div>
 


    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="edit-modal">
        <div class="edit-modal-content">
            <span class="edit-close-button" onclick="closeEditModal()">&times;</span>
            <h2 class="edit-modal-title">Edit Profile</h2>
            
            <form id="editProfileForm" method="POST" action="{% url 'view_owners' %}"> <!-- Replace 'view_owners' with your edit owner view name if needed -->
                {% csrf_token %}
                
                <div class="edit-modal-field">
                    <label for="editEmail">Email</label>
                    <input type="email" style="opacity: 0.5;" id="editEmail" name="email" placeholder="Enter your email" required readonly>
                </div>
                
                <div class="edit-modal-field">
                    <label for="editFirstname">First Name</label>
                    <input type="text" id="editFirstname" name="firstname" placeholder="Enter your first name" required>
                </div>
    
                <div class="edit-modal-field">
                    <label for="editMiddlename">Middle Name</label>
                    <input type="text" id="editMiddlename" name="middlename" placeholder="Enter your middle name">
                </div>
                
                <div class="edit-modal-field">
                    <label for="editLastname">Last Name</label>
                    <input type="text" id="editLastname" name="lastname" placeholder="Enter your last name" required>
                </div>
                
                <div class="edit-modal-field">
                    <label for="editPhoneNumber">Phone Number</label>
                    <input type="tel" id="editPhoneNumber" name="phone_number" placeholder="Enter your phone number" required>
                </div>
                
                <div class="edit-modal-field">
                    <label for="editAddress">Address</label>
                    <input type="text" id="editAddress" name="address" placeholder="Enter your address" required>
                </div>
                
                <div class="edit-modal-field">
                    <label for="editGender">Gender</label>
                    <select id="editGender" name="gender" required>
                        <option value="" disabled selected>Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="edit-modal-field">
                    <label for="editBirthday">Birthday</label>
                    <input type="date" id="editBirthday" name="birthday" required>
                </div>
                
                <button type="submit" class="edit-save-button">Save Changes</button>
            </form>
        </div>
    </div>
    
    <!-- Removal Modal -->
    <div class="confirm-removal-popup" id="confirmRemovalPopup" style="display: none;">
        <div class="confirmation-popup-content">
            <button class="confirmation-close-button" onclick="closeconfirmRemovalPopup()">&times;</button>
            <h2>Confirm Account Removal</h2>
            <p id="displayEmailRemoval" style="color: #4b5563; margin-bottom: 1.5rem;">Email: <span style="font-weight: bold;">[email]</span></p><br>
            <p>Are you sure you want to remove this account?</p>
            <form id="confirmationForm" method="POST" action="{% url 'view_owners' %}">
                {% csrf_token %}
                <input type="hidden" id="confirmEmail2" name="email" value=""> 
                <button type="submit" name="delete_account" class="confirm-button">Confirm Removal</button>
            </form>
        </div>
    </div>
    
<script>
    document.addEventListener('DOMContentLoaded', function() {
         // Function to format time logged out
    function formatTimeLoggedOut(seconds) {
        if (seconds >= 86400) {
            const days = Math.floor(seconds / 86400);
            return days === 1 ? "1 day" : `${days} days`;
        } else if (seconds >= 3600) {
            const hours = Math.floor(seconds / 3600);
            const remainingMinutes = Math.floor((seconds % 3600) / 60);
            return hours === 1 
                ? `1 hour${remainingMinutes ? `, ${remainingMinutes} minutes` : ''}`
                : `${hours} hours${remainingMinutes ? `, ${remainingMinutes} minutes` : ''}`;
        } else if (seconds >= 60) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return minutes === 1 
                ? `1 minute${remainingSeconds ? `, ${remainingSeconds} seconds` : ''}`
                : `${minutes} minutes${remainingSeconds ? `, ${remainingSeconds} seconds` : ''}`;
        } else {
            return `${seconds} second${seconds === 1 ? '' : 's'}`;
        }
    }

    // Calculate and display formatted time for each student
    document.querySelectorAll('.formatted-time').forEach(function(element) {
        const seconds = parseInt(element.getAttribute('data-loggedout'));
        element.textContent = formatTimeLoggedOut(seconds);
    });
        

        const messageList = document.querySelector('.message-list');

                
            if (messageList) {
                setTimeout(() => {
                    messageList.style.transition = "opacity 0.5s ease"; // Transition effect
                    messageList.style.opacity = 0; // Fade out effect
                    setTimeout(() => {
                        messageList.remove(); // Remove from DOM after fading out
                    }, 500); // Match this duration with the transition time
                }, 2000); // 2 seconds before starting to fade out
            }

        
            function openProfileModal(owner) {
                const modal = document.getElementById("profileModal");

                // Populate modal with owner data
                modal.querySelector("#modalName").innerText = owner.firstname + " " + owner.lastname;
                modal.querySelector("#modalEmail").innerText = owner.email;
                document.querySelector('input[name="owner_email"]').value = owner.email;
                modal.querySelector("#modalPhone").innerText = owner.phone_number;
                modal.querySelector("#modalAddress").innerText = owner.address;
                modal.querySelector("#modalGender").innerText = owner.gender;
                modal.querySelector("#modalBoardingHouse").innerText = owner.boardinghouseName || 'No boarding house data';
                modal.querySelector("#modalBoardingHouseStatus").innerText = owner.boardinghouseStatus;
                modal.querySelector("#modalAccountStatus").innerText = owner.accountStatus;
                modal.querySelector("#modalActiveStatus").innerText = owner.active_status;
                modal.querySelector("#modalSignupTime").innerText = owner.signup_time;  // Adjust to your desired time field
                modal.querySelector("#modalProfilePicture").src = owner.profile_picture || "{% static 'default_profile.png' %}";

                // Display modal
                modal.style.display = "block";
            }
    
        // Function to close the modal
        function closeProfileModal() {
            document.getElementById("profileModal").style.display = "none";
        }
    
        function openEditModal(firstname, middlename, lastname, phone_number, address, gender, birthday, email) {
                const modal = document.getElementById("editProfileModal");

                if (!modal) {
                    console.error("Modal not found!");
                    return;
                }

                // Populate the fields with owner data
                document.getElementById("editFirstname").value = firstname;
                document.getElementById("editMiddlename").value = middlename;
                document.getElementById("editLastname").value = lastname;
                document.getElementById("editPhoneNumber").value = phone_number;
                document.getElementById("editAddress").value = address;

                // Set the gender dropdown value
                const genderDropdown = document.getElementById("editGender");
                genderDropdown.value = gender;

                document.getElementById("editBirthday").value = birthday;
                document.getElementById("editEmail").value = email;

                // Show the modal
                modal.style.display = "block";
            }

            


    
        // Function to close the edit modal
        function closeEditModal() {
            const modal = document.getElementById("editProfileModal");
            if (modal) {
                modal.style.display = "none";
            }
        }
    
        // Move confirmation popup functions outside of openEditModal
        function openConfirmationPopup(email) {
            console.log("Opening confirmation popup for:", email);
            document.getElementById("confirmEmail").value = email;
            document.getElementById("displayEmail").innerHTML = `Email: <span style="font-weight: bold;">${email}</span>`;

            document.getElementById("confirmationPopup").style.display = "block";
        }
    
        function closeConfirmationPopup() {
            document.getElementById("confirmationPopup").style.display = "none";
        }

        function closeconfirmRemovalPopup() {
            document.getElementById("confirmRemovalPopup").style.display = "none";
        }
    
        // Make functions globally accessible
        window.openProfileModal = openProfileModal;
        window.closeProfileModal = closeProfileModal;
        window.openEditModal = openEditModal;
        window.closeEditModal = closeEditModal;
        window.openConfirmationPopup = openConfirmationPopup;
        window.closeConfirmationPopup = closeConfirmationPopup;
        window.closeconfirmRemovalPopup = closeconfirmRemovalPopup;
    });

    function confirmRemoval(email) {
        console.log('Email for removal:', email);  // Debugging
        document.getElementById('confirmEmail2').value = email;
        document.getElementById('displayEmailRemoval').innerHTML = `Email: <span style="font-weight: bold;">${email}</span>`;

        document.getElementById('confirmRemovalPopup').style.display = 'flex';
    }

const messages = document.querySelectorAll('.successAnderrorMessagesPoppedup');
    
    messages.forEach(message => {
        // Set timeout to remove message after 3 seconds
        setTimeout(() => {
            message.classList.add('slideOut');
            
            // Remove element after animation completes
            message.addEventListener('animationend', function(e) {
                if (e.animationName === 'successAnderrorMessagesPoppedup-slideOut') {
                    message.remove();
                }
            });
        }, 3000);
    });


    document.querySelector('input[placeholder="Search owners..."]').addEventListener('input', function (e) {
    const query = e.target.value.toLowerCase().trim(); // Normalize query
    const rows = document.querySelectorAll('#ownerTableBody tr.hover-trigger'); // Adjust selector if owners have a different tbody ID

    rows.forEach(row => {
        const firstname = row.getAttribute('data-firstname').toLowerCase();
        const lastname = row.getAttribute('data-lastname').toLowerCase();
        const boardinghouseName = row.getAttribute('data-boardinghouse-name').toLowerCase();

        // Show row if any attribute matches the query
        if (firstname.includes(query) || lastname.includes(query) || boardinghouseName.includes(query)) {
            row.style.display = ''; // Show row
            row.nextElementSibling.style.display = ''; // Show hover-target row
        } else {
            row.style.display = 'none'; // Hide row
            row.nextElementSibling.style.display = 'none'; // Hide hover-target row
        }
    });
});



const allStudents = {{ students|safe }}; // Fetch all students passed from the backend

function filterStudentsByOwner(boardinghouseName) {
    const modal = document.getElementById('studentsBoardingApplied');
    const modalContent = document.getElementById('modalContent');
    const modalTitle = document.getElementById('modalTitle'); // Get the title element

    // Update modal title
    if (modalTitle) {
        modalTitle.textContent = `Students Applied in ${boardinghouseName}`;
    }

    // Filter students whose boarding house matches the owner's
    const filteredStudents = allStudents.filter(student => student.boardinghouseName === boardinghouseName);

    // Populate modal content
    if (modal) {
        modal.style.display = 'flex';
        if (filteredStudents.length > 0) {
            modalContent.innerHTML = filteredStudents
                .map(student => `
                    <div class="mb-4 p-4 bg-gray-100 rounded-lg shadow">
                        <div class="flex items-center">
                            <img class="h-12 w-12 rounded-full object-cover" 
                                 src="${student.profile_picture || '/default-profile.png'}" 
                                 alt="${student.username}">
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold">${student.username}</h3>
                                <p class="text-gray-600">Student ID: ${student.student_id}</p>
                                <p class="text-gray-600">Room Name: ${student.roomName}</p>
                                <p class="text-gray-600">Date approved by the owner: ${student.schedule_date}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
        } else {
            modalContent.innerHTML = `<p class="text-gray-500">No students found for this boarding house.</p>`;
        }
    } else {
        console.error('Modal with ID "studentsBoardingApplied" not found.');
    }
}

function closeStudentsBoardingAppliedModal() {
    const modal = document.getElementById('studentsBoardingApplied');
    if (modal) {
        modal.style.display = 'none';
    }
}


// Responsive adjustments using JavaScript for mobile
function adjustModalForScreen() {
        const modal = document.querySelector('.modal-container');
        const width = window.innerWidth;

        if (width <= 768) { // Tablet and mobile screens
            modal.style.width = '90%';
            modal.style.padding = '1.5rem';
        }

        if (width <= 480) { // Small mobile screens
            modal.style.width = '95%';
        }
    }

    window.addEventListener('resize', adjustModalForScreen);
    window.addEventListener('load', adjustModalForScreen);
    </script>
</body>
{% endblock %}
